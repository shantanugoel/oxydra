# Oxydra agent configuration.
# Copy to ./.oxydra/agent.toml and customize as needed.
#
# All values shown below are the defaults. Uncomment and change as needed.
# For full documentation, see docs/guidebook/02-configuration-system.md

config_version = "1.0.0"

# --- Provider selection ---
# The provider name must match an entry in [providers.registry.*].
# Supported provider types: "openai", "anthropic", "gemini", "openai_responses"
# Available models (from pinned catalog):
#   OpenAI:    gpt-4.1, gpt-4.1-mini, gpt-4.1-nano, gpt-4o, gpt-4o-mini, o3-mini
#   Anthropic: claude-3-5-haiku-latest, claude-3-5-sonnet-latest
#   Google:    (populated by `catalog fetch`; set GEMINI_API_KEY)
[selection]
provider = "openai"
model    = "gpt-4o-mini"

# --- Runtime limits ---
[runtime]
turn_timeout_secs = 60   # Max seconds per LLM call
max_turns         = 25    # Max agentic loop iterations
# max_cost        = 1000.0  # Optional cumulative cost cap (provider-reported units)

# Context window management — triggers summarization when usage exceeds trigger_ratio.
[runtime.context_budget]
trigger_ratio              = 0.85    # Fraction of max context that triggers compaction
safety_buffer_tokens       = 1024    # Tokens reserved below the hard limit
fallback_max_context_tokens = 128000 # Used when the model catalog has no entry

# Conversation summarization — compresses older turns to stay within budget.
[runtime.summarization]
target_ratio = 0.5  # Target context usage after summarization (fraction of max)
min_turns    = 6    # Minimum turns before summarization is eligible

# --- Memory (libSQL-backed persistence) ---
[memory]
enabled = false
# remote_url = "libsql://your-database.turso.io"  # Optional Turso remote
# auth_token = "set-me-or-use-OXYDRA__MEMORY__AUTH_TOKEN"  # Required when remote_url is set

# Hybrid retrieval weights (must sum to 1.0).
[memory.retrieval]
top_k         = 8    # Number of results returned per query
vector_weight = 0.7  # Weight for vector (embedding) similarity
fts_weight    = 0.3  # Weight for full-text search scoring

# --- Retry / reliability ---
[reliability]
max_attempts    = 3     # Total attempts per LLM call (1 = no retries)
backoff_base_ms = 250   # Initial backoff delay
backoff_max_ms  = 2000  # Maximum backoff delay
jitter          = false # Add randomized jitter to backoff

# --- Provider registry, endpoints, and credentials ---
# API keys can also be set via environment variables:
#   OPENAI_API_KEY, ANTHROPIC_API_KEY, GEMINI_API_KEY, or fallback API_KEY
#
# The base_url can point to any compatible endpoint (e.g. OpenRouter,
# Azure OpenAI, or a local proxy).

# --- Example: Google Gemini ---
# [providers.registry.gemini]
# provider_type = "gemini" # Configures the `type` of API to communicate upstream
# api_key_env = "GEMINI_API_KEY"

# --- Example: OpenAI Responses API (stateful session chaining) ---
# [providers.registry.openai-responses]
# provider_type = "openai_responses"
# api_key_env = "OPENAI_API_KEY"

# --- Example: OpenRouter (or other OpenAI-compatible proxy) ---
# Requires catalog.skip_catalog_validation = true for models not in the
# pinned catalog.
# [providers.registry.openrouter]
# provider_type = "openai"
# base_url = "https://openrouter.ai/api/v1"
# api_key_env = "OPENROUTER_API_KEY"
# catalog_provider = "openrouter"
# reasoning = true              # If the model supports reasoning/thinking
# max_context_tokens = 200000   # Override default 128K context
# max_output_tokens = 8192      # Override default 16K output

# --- Tool-specific configuration ---
# Structured alternative to OXYDRA_WEB_SEARCH_* environment variables.
# Explicit env vars always take precedence over values set here.

# [tools.web_search]
# provider = "duckduckgo"                     # "duckduckgo" (default), "google", or "searxng"
# base_url = "https://api.duckduckgo.com/"    # Override default base URL for the selected provider
# base_urls = "https://url1,https://url2"     # Comma-separated fallback base URLs
# api_key_env = "MY_GOOGLE_API_KEY"           # Env var name holding Google API key
# engine_id_env = "MY_GOOGLE_CX"             # Env var name holding Google engine/CX ID
# query_params = "key=value&key2=value2"      # Extra query parameters
# # SearxNG-specific:
# engines = "google,bing"                     # SearxNG search engines
# categories = "general"                      # SearxNG categories
# safesearch = 1                              # SearxNG safesearch level (0-2)

# --- Catalog resolution and validation ---
[catalog]
skip_catalog_validation = false  # Set true to allow models not in the catalog
# pinned_url = "https://raw.githubusercontent.com/..."  # Override pinned snapshot URL
